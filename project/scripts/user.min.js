"use strict";!function(){var h={tryGlobal:!0,defaultStrings:{empty:"The inventory is empty...",listDrop:"Discard",separator:"\n"}};function s(r,i,t,n){$(document).trigger({type:"initialized"===n?":inventory-init":":inventory-update",instance:r,receiving:i,moved:t,context:n})}function c(r){if(r=r?(r=[].slice.call(arguments)).flatten():[],!(this instanceof c))return new c(r);this.inv=r,s(this,null,r=r.length?r:null,"initialized")}Object.assign(c,{is:function(r){return r instanceof c},log:function(r){return c.is(r)?"Inventory.log() -> "+r.toArray().join(" - "):"Inventory.log() -> object is not an inventory..."},removeDuplicates:function(r){if(c.is(r)){var i,r=r.toArray();return i=[],r.forEach(function(r){i.includes(r)||i.push(r)}),i}}}),Object.assign(c.prototype,{transfer:function(r){if(arguments.length<2)return this;if(!c.is(r))return this;for(var i=[].slice.call(arguments),t=[],n=0,e=(i=i.slice(1).flatten()).length;n<e;n++)this.inv.includes(i[n])&&(this.inv.delete(i[n]),t.push(i[n]));return t.length&&(r.inv=r.inv.concat(t),s(this,r,t,"transfer")),this},has:function(){var r=[].slice.call(arguments).flatten();return!(!r||!r.length)&&this.inv.includesAny(r)},hasAll:function(){var r=[].slice.call(arguments).flatten();return!(!r||!r.length)&&this.inv.includesAll(r)},pickUp:function(r){var i,t=[].slice.call(arguments).flatten(),n=this;return t&&t.length&&("unique"!==r&&"unique"!==t[0]||(t=t.splice(1),i=[],t.forEach(function(r){n.inv.includes(r)||i.includes(r)||i.push(r)}),t=i),this.inv=this.inv.concat(t),s(this,null,t,"pickup")),this},drop:function(){var i,t,r=[].slice.call(arguments).flatten(),n=this;return r&&r.length&&(t=[],r.forEach(function(r){n.has(r)&&(t.push(r),i=n.inv.indexOf(r),n.inv.deleteAt(i))}),s(this,null,t,"drop")),this},sort:function(){return this.inv=this.inv.sort(),s(this,null,null,"sort"),this},show:function(r){return r&&"string"==typeof r||(r=h.defaultStrings.separator),this.inv.length?this.inv.join(r):h.defaultStrings.empty},empty:function(){var r=clone(this.inv);return this.inv=[],s(this,null,r,"drop"),this},toArray:function(){return this.inv},count:function(i){if(i&&"string"==typeof i){var t=0;return this.toArray().forEach(function(r){r===i&&t++}),t}return this.toArray().length},isEmpty:function(){return 0===this.toArray().length},linkedList:function(a,o){a&&c.is(a)||(a=!1);var r=this.toArray(),l=this,u=$(document.createElement("span"));return r&&r.length?r.forEach(function(r,i,t){var n=$(document.createElement("span")),e=$(document.createElement("a")),s=(o||h.defaultStrings.drop,function(r,i){var t=Math.random().toString(36).substring(7);return arguments.length<2&&(r=Math.random().toString(36).substring(7),i=random(99)),"simple-inv-"+i+"-"+Date.now()+"-"+r.replace(/[^A-Za-z0-9]/g,"")+"-"+t}(r,i));e.ariaClick(function(){a?l.transfer(a,r):l.drop(r),$("#"+s).empty()}),n.attr("id",s).addClass("simple-inv link-listing").wiki(r+" ").append(e),i<t.length-1&&n.wiki("<br />"),u.append(n)}):u.wiki(h.defaultStrings.empty),u},constructor:c,toJSON:function(){return JSON.reviveWrapper("new setup.Inventory("+JSON.stringify(this.inv)+")")},clone:function(){return new c(this.inv)}}),setup.Inventory=c,setup.simpleInv={inventory:c},h.tryGlobal&&(window.Inventory=window.Inventory||c),Macro.add("newinventory",{handler:function(){if(this.args.length<1)return this.error("incorrect number of arguments");var r=this.args[0].trim();if("$"!==r[0]&&"_"!==r[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');Wikifier.setValue(r,new c(this.args.slice(1).flatten()))}}),Macro.add("pickup",{handler:function(){if(this.args.length<2)return this.error("incorrect number of arguments");var r=this.args[0].trim();if("$"!==r[0]&&"_"!==r[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var i=Wikifier.getValue(r);if(!c.is(i))return this.error("variable "+r+" is not an inventory!");i.pickUp(this.args.slice(1).flatten())}}),Macro.add("drop",{handler:function(){if(this.args.length<2)return this.error("incorrect number of arguments");var r=this.args[0].trim();if("$"!==r[0]&&"_"!==r[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var i=Wikifier.getValue(r);if(!c.is(i))return this.error("variable "+r+" is not an inventory!");i.drop(this.args.slice(1).flatten())}}),Macro.add("transfer",{handler:function(){if(this.args.length<3)return this.error("incorrect number of arguments");var r=this.args[0].trim();if("$"!==r[0]&&"_"!==r[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var i=Wikifier.getValue(r);if(!c.is(i))return this.error("variable "+r+" is not an inventory!");var t=this.args[1].trim();if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[1]+'" is missing its sigil ($ or _)');r=Wikifier.getValue(t);if(!c.is(r))return this.error("variable "+t+" is not an inventory!");i.transfer(r,this.args.slice(2).flatten())}}),Macro.add("dropall",{handler:function(){if(1!==this.args.length)return this.error("incorrect number of arguments");var r=this.args[0].trim();if("$"!==r[0]&&"_"!==r[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var i=Wikifier.getValue(r);if(!c.is(i))return this.error("variable "+r+" is not an inventory!");i.empty()}}),Macro.add("clear","dropall",!1),Macro.add("sort",{handler:function(){if(1!==this.args.length)return this.error("incorrect number of arguments");var r=this.args[0].trim();if("$"!==r[0]&&"_"!==r[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var i=Wikifier.getValue(r);if(!c.is(i))return this.error("variable "+r+" is not an inventory!");i.sort()}}),Macro.add("inventory",{handler:function(){if(this.args.length<1||2<this.args.length)return this.error("incorrect number of arguments");var r=this.args[0].trim();if("$"!==r[0]&&"_"!==r[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var i=Wikifier.getValue(r);if(!c.is(i))return this.error("variable "+r+" is not an inventory!");var t=$(document.createElement("span")),r=this.args[1]||!1;t.wiki(i.show(r)).addClass("macro-"+this.name).appendTo(this.output)}}),Macro.add("linkedinventory",{handler:function(){if(this.args.length<2||3<this.args.length)return this.error("incorrect number of arguments");var r=!1,i="",t=this.args[1].trim(),n="string"==typeof this.args[0]&&this.args[0];if(!n)return this.error("first argument should be the link text");if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[1]+'" is missing its sigil ($ or _)');var e=Util.slugify(t),e=this.name+"-"+e,s=Wikifier.getValue(t);if(!c.is(s))return this.error("variable "+t+" is not an inventory!");if(2<this.args.length){if("$"!==(i=this.args[2].trim())[0]&&"_"!==i[0])return this.error('variable name "'+this.args[2]+'" is missing its sigil ($ or _)');if(r=Wikifier.getValue(i),!c.is(r))return this.error("variable "+i+" is not an inventory!")}s.linkedList(r,n).attr({id:e,"data-rec":i,"data-self":t,"data-action":n}).addClass("macro-"+this.name).appendTo(this.output)}})}();
"use strict";function _createForOfIteratorHelper(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw i}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Macro.add("glow",{skipArgs:!1,handler:function(){try{var e=document.querySelector(":root");e.style.setProperty("--bgglow",this.args[0]),e.style.setProperty("--bgtime",this.args[1])}catch(e){return this.error("you got an error from the glow macro: "+e.message)}}}),Macro.add("varchange",{skipArgs:!1,handler:function(){try{var e=document.querySelector(":root").style;switch(this.args[0]){case"arisa":e.setProperty("--sidebarR","#ff007f");break;case"redia":e.setProperty("--sidebarR","#FF3030");break;case"suiko":e.setProperty("--sidebarR","#734f96");break;case"sara":e.setProperty("--sidebarR","#fbec5d");break;case"randy":e.setProperty("--sidebarR","#ff8243");break;case"lilith":e.setProperty("--sidebarR","#6b00b3");break;case"amber":e.setProperty("--sidebarR","#113f11");break;case"karen":e.setProperty("--sidebarR","#1E90FF");break;default:e.setProperty("--sidebarR","inherit")}}catch(e){return this.error("you got an error from the "+this.name+": "+e.message)}}}),Macro.add("dialog",{tags:["onopen","onclose"],handler:function(){var r="",n=null,i=null,e=0<this.args.length?this.args[0]:"",t=1<this.args.length?this.args.slice(1).flatten():[];this.payload.forEach(function(e,t){0===t?r=e.contents:"onopen"===e.name?n=n?n+e.contents:e.contents:i=i?i+e.contents:e.contents}),t.push("macro-"+this.name),Dialog.setup(e,t.join(" ")),Dialog.wiki(r),n&&"string"==typeof n&&n.trim()&&$(document).one(":dialogopened",function(){$.wiki(n)}),i&&"string"==typeof i&&i.trim()&&$(document).one(":dialogclosed",function(){$.wiki(i)}),Dialog.open()}}),Macro.add("popup",{handler:function(){if(this.args.length<1)return this.error("need at least one argument; the passage to display");if(!Story.has(this.args[0]))return this.error("the passage "+this.args[0]+"does not exist");var e=this.args[0],t=1<this.args.length?this.args[1]:"",r=2<this.args.length?this.args.slice(2).flatten():[];r.push("macro-"+this.name),Dialog.setup(t,r.join(" ")),Dialog.wiki(Story.get(e).processText()),Dialog.open()}}),Macro.add("dialogclose",{skipArgs:!0,handler:function(){Dialog.close()}}),function(){var e=!0,a=!1,o=!1,i={full:"#2ECC40",empty:"#FF4136",back:"#DDDDDD",height:"12px",width:"inherit",animate:400,easing:"swing",text:"#111111",label:"",align:"center"},s=["center","left","right"],l=["swing","linear"];function h(e,t){return e&&"string"==typeof e&&(e=e.toLowerCase().trim())?e:t||""}function u(e){return e<.5?2*e*e:(4-2*e)*e-1}function c(e,t){if(!(this instanceof c))return new c(e,t);var r=clone(i);this.settings=Object.assign(r,e),this.settings.align=h(this.settings.align),this.settings.easing=h(this.settings.easing),s.includes(this.settings.align)||(this.settings.align="center"),l.includes(this.settings.easing)||(this.settings.easing="swing"),t=Number(t),Number.isNaN(t)&&(t=1),t=Math.clamp(t,0,1),this.value=t;var n=$(document.createElement("div")).addClass("chapel-meter").attr({"data-val":t,"data-label":this.settings.label}).css({position:"relative","background-color":this.settings.back,height:this.settings.height,width:this.settings.width,overflow:"hidden"}),r=$(document.createElement("div")).addClass("meter-label").css({top:0,right:0,"font-size":this.settings.height,"font-weight":"bold","line-height":"100%",width:"100%",height:"100%","vertical-align":"middle","text-align":this.settings.align,color:this.settings.text,"z-index":1,position:"relative",bottom:"100%"}).wiki(this.settings.label).appendTo(n),e=$(document.createElement("div")).addClass("meter-top").css({"background-color":this.settings.full,opacity:u(this.value),width:"100%",height:"100%","z-index":0}),t=$(document.createElement("div")).addClass("meter-bottom").css({position:"absolute",top:0,left:0,"background-color":this.settings.empty,opacity:1,width:100*this.value+"%",height:"100%","z-index":0}).append(e).appendTo(n);this.$element=n,this.$bars={top:e,bottom:t},(this.$label=r).css("font-size",parseInt(n.css("height"),10)<parseInt($(".passage").css("font-size"),10)?n.css("height"):$(".passage").css("font-size")),r.css("line-height",n.css("height"))}Object.assign(c,{_list:new Map,is:function(e){return e instanceof c},has:function(e){return c._list.has(e)&&c.is(c._list.get(e))},get:function(e){return c.has(e)?c._list.get(e):null},del:function(e){c.has(e)&&c._list.delete(e)},add:function(e,t,r){if(!c.has(e)||a){Object.assign(t,{id:e});r=new c(t,r);return c._list.set(e,r),r}console.error('Meter "'+e+'" already exists.')},_emit:function(e,t){c.is(e)&&e.$element.trigger({type:":"+t,meter:e})}}),Object.assign(c.prototype,{constructor:c,_label:function(e){var t=this;function r(){t.$label.empty().wiki(t.settings.label),t.$label.css("font-size",parseInt(t.$element.css("height"),10)<parseInt(t.$element.parent().css("font-size"),10)?t.$element.css("height"):t.$element.parent().css("font-size")),t.$label.css("line-height",t.$element.css("height"))}return e?setTimeout(r,Engine.minDomActionDelay):r(),this},_width:function(){var e=this;return this.$bars.bottom.animate({width:100*this.value+"%"},this.settings.animate,this.settings.easing,function(){c._emit(e,"meter-animation-complete")}),this},_color:function(){return this.$bars.top.animate({opacity:u(this.value)},this.settings.animate,this.settings.easing),this},animate:function(){return c._emit(this,"meter-animation-start"),this._color()._width()._label()},val:function(e){return void 0!==e&&(e=Number(e),Number.isNaN(e)&&(e=1),e=Math.clamp(e,0,1),this.value=e,this.animate()),this.value},options:function(e){return e&&"object"===_typeof(e)&&Object.assign(this.settings,e),this.settings},unwrap:function(){return this.$element[0]},place:function(e,t){var r=$(document.createElement("span"));return e instanceof jQuery||(e=$(e)),e[0]||console.warn("meter#place() -> no valid target"),t&&"object"===_typeof(t)&&(t.classes&&(Array.isArray(t.classes)||"string"==typeof t.classes)&&r.addClass(t.classes),t.attr&&"object"===_typeof(t.attr)&&r.attr(t.attr)),e.append(r.append(this.$element)),this._label(!0),this},on:function(e,t){return"function"!=typeof t||e&&"string"==typeof e&&e.trim()&&(e=e.split(" ").map(function(e){return(e=e.split(".")[0])+".userland"}).join(" "),this.$element.on(e,t)),this},one:function(e,t){return"function"!=typeof t||e&&"string"==typeof e&&e.trim()&&(e=e.split(" ").map(function(e){return(e=e.split(".")[0])+".userland"}).join(" "),this.$element.one(e,t)),this},off:function(e){return e=e&&"string"==typeof e&&e.trim()?e.split(" ").map(function(e){return(e=e.split(".")[0])+".userland"}).join(" "):".userland",this.$element.off(e),this},click:function(e,t){return this.$element.ariaClick(e,t),this},clone:function(){return new c(this.settings,this.value)},toJSON:function(){return JSON.reviveWrapper("new setup.Meter("+JSON.stringify(this.settings)+", "+this.value+")")}}),setup.Meter=c,e&&(window.Meter=window.Meter||c),Macro.add("newmeter",{tags:["colors","sizing","animation","label"],handler:function(){if(0<State.length&&!o)return this.error("The `<<newmeter>>` macro must be called in your `StoryInit` special passage. Seriously. No excuses. --Love, Chapel");if(this.args.length<1)return this.error("The `<<newmeter>>` macro requires at least one argument: a meter name.");var e=this.args[0],t=null,r=null,n=null,i=null;if("string"!=typeof e)return this.error("Invalid meter name. meter name must be string");if(e=e.trim(),c.has(e)&&!a)return this.error('Cannot clobber the existing meter "'+e+'".');this.payload.length&&(t=this.payload.find(function(e){return"colors"===e.name}),r=this.payload.find(function(e){return"sizing"===e.name}),n=this.payload.find(function(e){return"animation"===e.name}),i=this.payload.find(function(e){return"label"===e.name}));var s={};if(t){if(!t.args.length)return this.error("No arguments passed to the `<<colors>>` tag.");switch(t.args.length){case 1:s.empty=t.args[0],s.full="transparent";break;case 2:s.full=t.args[0],s.empty=t.args[1];break;default:s.full=t.args[0],s.empty=t.args[1],s.back=t.args[2]}}if(r){if(!r.args.length)return this.error("No arguments passed to the `<<sizing>>` tag.");s.width=r.args[0],r.args[1]&&(s.height=r.args[1])}if(n){if(!n.args.length)return this.error("No arguments passed to the `<<animation>>` tag.");if("boolean"!=typeof n.args[0]||n.args[0]){if("string"!=typeof n.args[0])return this.error("The argument to the `<<animation>>` tag should be `true`, `false`, or a valid CSS time value.");s.animate=Util.fromCssTime(n.args[0])}else s.animate=0;n.args[1]&&["swing","linear"].includes(n.args[1])&&(s.easing=n.args[1])}if(i){n=i.args[0];if(!n||"string"!=typeof n)return this.error("The labelText argument for the `<<label>>` tag is required.");s.label=n.trim(),i.args[1]&&"string"==typeof i.args[1]&&(s.text=i.args[1]),i.args[2]&&"string"==typeof i.args[2]&&(s.align=i.args[2])}c.add(e,s,this.args[1])}}),Macro.add("showmeter",{handler:function(){if(this.args.length<1)return this.error("This macro requires at least one argument: the meter's name.");var e=this.args[0];if("string"!=typeof e)return this.error("Invalid meter name.");e=e.trim();var t=c.get(e);if(!t||!c.is(t))return this.error('The meter "'+e+'" does not exist.');"number"==typeof this.args[1]&&t.val(this.args[1]),t.place(this.output,{classes:"macro-"+this.name,attr:{id:"meter-"+Util.slugify(e)}})}}),Macro.add("updatemeter",{handler:function(){if(this.args.length<2)return this.error("This macro requires two arguments: the meter's name and a value.");var e=this.args[0];if("string"!=typeof e)return this.error("Invalid meter name.");e=e.trim();var t=c.get(e);if(!t||!c.is(t))return this.error('The meter "'+e+'" does not exist.');t.val(this.args[1])}})}(),Macro.add("notify",{tags:null,handler:function(){$(document.body).overhang({type:this.args[0]||"info",duration:Number.parseInt(this.args[1])||3,easing:"swing",message:"",varedit:this.args[2]}).find(".overhang .overhang-message").empty().wiki(this.payload[0].contents)}}),function(l){l.fn.overhang=function(e){function t(e,t){n.slideUp(s.speed,function(){e&&s.callback(null!==t?r.data(t):"")})}var r=l(this),n=l("<div class='overhang'></div>");l(".overhang").remove();var i={success:["#2ECC71","#27AE60"],error:["#E74C3C","#C0392B"],warn:["#E67E22","#D35400"],info:["#3498DB","#2980B9"],prompt:["#9B59B6","#8E44AD"],confirm:["#1ABC9C","#16A085"],blank:["#34495E","#2C3E50"]},s=l.extend({type:"success",message:"This is an overhang.js message!",textColor:"#FFFFFF",yesMessage:"Yes",noMessage:"No",yesColor:"#2ECC71",noColor:"#E74C3C",duration:1.5,speed:500,closeConfirm:!1,upper:!1,easing:"easeOutBounce",html:!1,callback:function(){}},e);switch(-1===l.inArray(s.type,"success error warn info prompt confirm".split(" "))&&(s.type="blank",console.log("You have entered invalid type name for an overhang message.")),e.custom?(s.primary=e.primary,s.accent=e.accent):(s.primary=i[s.type][0]||"#ECF0F1",s.accent=i[s.type][1]||"#BDC3C7"),s.type){case"prompt":case"confirm":s.primary=e.primary||i[s.type][0],s.accent=e.accent||i[s.type][1],s.closeConfirm=!0}n.css("background-color",s.primary),n.css("border-bottom","6px solid "+s.accent),(e=l("<span class='overhang-message'></span>")).css("color",s.textColor),s.html?e.html(s.message):e.text(s.upper?s.message.toUpperCase():s.message),n.append(e);var a,o=l("<input class='overhang-prompt-field' />");switch(e=l("<button class='overhang-yes-option'>"+s.yesMessage+"</button>"),i=l("<button class='overhang-no-option'>"+s.noMessage+"</button>"),e.css("background-color",s.yesColor),i.css("background-color",s.noColor),s.closeConfirm&&((a=l("<span class='overhang-close'></span>")).css("color",s.accent),"confirm"!==s.type&&n.append(a)),s.type){case"prompt":n.append(o),r.data("overhangPrompt",null),o.keydown(function(e){if(13===e.keyCode){if(r.data("overhangPrompt",o.val()),e="SugarCube.State.active.variables."+s.varedit+" = "+o.val(),console.log(o.val()),o.val()){console.log("the version for strings");try{Function("return ("+e+")")()}catch(e){throw alert('you probably didnt put "around the text" ')}}else{console.log("the normal version for numbers");try{Function("return ("+e+")")()}catch(e){alert("i honestly dont know how u got this error")}}t(!0,"overhangPrompt")}});break;case"confirm":n.append(e),n.append(i),n.append(a),r.data("overhangConfirm",null),e.click(function(){r.data("overhangConfirm",!0),t(!0,"overhangConfirm")}),i.click(function(){r.data("overhangConfirm",!1),t(!0,"overhangConfirm")})}return r.append(n),s.closeConfirm?(n.slideDown(s.speed,s.easing),a.click(function(){return"prompt"!==s.type&&"confirm"!==s.type?(t(!0,null),test):void t(!1,null)})):n.slideDown(s.speed,s.easing).delay(1e3*s.duration).slideUp(s.speed,function(){t(!0,null)}),this}}(jQuery),State.variables.WinPosX=0,State.variables.WinPosY=0,$(document).on(":passageinit",function(e){0<State.length&&(State.history[State.length-1].variables.WinPosX=window.scrollX,State.history[State.length-1].variables.WinPosY=window.scrollY)}),$(document).on(":passageend",function(e){(State.variables.WinPosX||State.variables.WinPosY)&&(window.scroll(State.variables.WinPosX,State.variables.WinPosY),State.variables.WinPosX=0,State.variables.WinPosY=0)});var $jscomp=$jscomp||{};$jscomp.scope={},$jscomp.createTemplateTagFirstArg=function(e){return e.raw=e},$jscomp.createTemplateTagFirstArgWithRaw=function(e,t){return e.raw=t,e},Config.navigation.override=function(){if(State.variables.BADEND)return"ArisaAwareScreen"},Config.history.controls=!0,Config.ui.stowBarInitially=!1,Config.saves.autoload=!1,Macro.add("scrolldown",{handler:function(){var e=document.scrollingElement||"html,body";if(0<this.args.length)switch(this.args[0]){case"fast":case"slow":var t=this.args[0];break;default:try{t=Math.max(Engine.minDomActionDelay,Util.fromCssTime(this.args[0]))}catch(e){return this.error(e.message)}}else t="slow";setTimeout(function(){$(e).animate({scrollTop:$(document).height()-$(window).height()},t)},Engine.minDomActionDelay)}}),function(){var i=(function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}(a,[{key:"finish",value:function(){for(this.abortTyping=!0;this.unfurl(););}},{key:"unfurl",value:function(e){if(this.append&&(e&&e.appendChild(this.node),this.append=!1),this.value)return this.node.nodeValue+=this.value[0],this.value=this.value.slice(1),!0;e=this.node;for(var t=0,r=this.childNodes.length;t<r;++t)if(this.childNodes[t].unfurl(e))return!0;return!1}}],[{key:"typeout",value:function(e,r,t){function n(){var e,t;i.abortTyping||(e=passage(),t=setInterval(function(){!i.abortTyping&&passage()===e&&i.unfurl()||clearInterval(t)},r))}var i=new a(e);return t?setTimeout(n,t):n(),i}}]),a),s=/^t8n-typewriter-(\d+)(?:-(\d+))?$/;function a(e,t){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");if(Object.defineProperties(this,{node:{value:e},childNodes:{value:[]},value:{writable:!0,value:""},append:{writable:!0,value:!!t},abortTyping:{writable:!0,value:!1}}),this.node.nodeValue&&(this.value=this.node.nodeValue,this.node.nodeValue=""),!this.node.style||"none"!==this.node.style.display)for(var r=this.node.childNodes;0<r.length;)this.childNodes.push(new a(r[0],!0)),this.node.removeChild(r[0])}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}postrender["t8n-typewriter-handler"]=function(e){$(document).off("keypress.t8n-typewriter");for(var t=this.tags,r=0;r<t.length;++r){var n=s.exec(t[r]);if(null!==n&&"break"===function(){var t=i.typeout(e,Number(n[1]),Number(n[2]));return $(document).on("keypress.t8n-typewriter",function(e){32!==e.which||e.target!==document.body&&e.target!==document.documentElement||(e.preventDefault(),$(document).off("keypress.t8n-typewriter"),t.finish())}),"break"}())break}}}();var $rightUiBar=$('<div id="right-ui-bar"></div>').insertAfter("#ui-bar"),rightTray=$rightUiBar.append('<div id="right-ui-bar-tray"><button id="right-ui-bar-toggle" tabindex="0" title="Toggle the Right UI bar" aria-label="Toggle the Right UI bar" type="button"></button></div>'),rightBody=$rightUiBar.append('<div id="right-ui-bar-body"></div>');$rightUiBar.find("#right-ui-bar-toggle").ariaClick({label:"Toggle the Right UI bar"},function(){return document.querySelector(":root").style.setProperty("--sidebarR","inherit"),$rightUiBar.toggleClass("stowed")}),postrender["Display Right Sidebar Contents"]=function(e,t){setPageElement("right-ui-bar-body","StoryRightSidebar")},setup.seenNewObservers=[],setup.seenOldObservers=[],Macro.add("seen",{tags:["content","hidden"],handler:function(){var e=0;this.args.length&&(e=parseFloat(this.args[0]),e=isNaN(e)?0:e.clamp(0,99)/100),null==State.temporary.SeenElementIndex&&(State.temporary.SeenElementIndex=0);var t=++State.temporary.SeenElementIndex,r='<span id="seen-macro-'+t+'">',n="";if(1<this.payload.length)for(var i=1;i<this.payload.length;++i)"hidden"===this.payload[i].name?n+=this.payload[i].contents:r+=this.payload[i].contents;r==='<span id="seen-macro-'+t+'">'&&(r+=" "),r+="</span>",$(this.output).wiki(r),window.IntersectionObserver&&setup.seenNewObservers.unshift({index:t,threshold:e,viscode:this.payload[0].contents,hidcode:n})}}),setup.seenHandler=function(e,t){"loading"!=$("html").attr("data-init")&&(e[0].intersectionRatio>t.threshold?t.hidden&&(t.hidden=!1,$.wiki(t.viscode)):0===e[0].intersectionRatio&&(t.hidden||(t.hidden=!0,$.wiki(t.hidcode))))},$(document).on(":passageend",function(e){for(;setup.seenOldObservers.length;)setup.seenOldObservers[0].disconnect(),setup.seenOldObservers.shift();for(var t;setup.seenNewObservers.length;)(t=0===setup.seenNewObservers[0].threshold?new IntersectionObserver(setup.seenHandler,{threshold:[0,.01,.99,1]}):new IntersectionObserver(setup.seenHandler,{threshold:[0,setup.seenNewObservers[0].threshold,1]})).observe($("#seen-macro-"+setup.seenNewObservers[0].index)[0]),t.index=setup.seenNewObservers[0].index,t.threshold=setup.seenNewObservers[0].threshold,t.viscode=setup.seenNewObservers[0].viscode,t.hidcode=setup.seenNewObservers[0].hidcode,t.hidden=!0,setup.seenOldObservers[0]=t,setup.seenNewObservers.shift()});var g=document.querySelector(":root");function randomColor(){for(var e="#",t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}var randomColors=function(){settings.RandomColorEveryPassage&&$(document).on(":passagestart",function(e){g.style.setProperty("--MainColor",randomColor()),g.style.setProperty("--main",randomColor())})};Setting.addToggle("RandomColorEveryPassage",{label:"Change background color every passage randomly",default:!1,onChange:randomColors});var toggleglow=function(){settings.toggleglow?$("html").css("text-shadow","none"):$("html").css("text-shadow","0 0 5px #c8c8c8")};Setting.addToggle("toggleglow",{label:"turn off text glow",default:!1,onInit:toggleglow,onChange:toggleglow}),Setting.addRange("Brightness",{label:"Brightness",min:0,max:220,step:2,default:120,onChange:function(){"Terminal"===settings.theme?(g.style.setProperty("--MainColor","radial-gradient(rgba(0, 255, 0, 0.75), black ".concat(settings.Brightness,"%")),g.style.setProperty("--main","radial-gradient(rgba(0, 255, 0, 0.75), black ".concat(settings.Brightness,"%"))):UI.alert("this is only used when the terminal theme is being used",{top:50},function(){UI.settings()})}});var settingThemeNames=["classic","Terminal","Random Color","custom"],settingThemeHandler=function(){switch(settings.theme){case"Terminal":brightnesss=1,g.style.setProperty("--MainColor","radial-gradient(rgba(0, 255, 0, 0.75), black 120%)"),g.style.setProperty("--main","radial-gradient(rgba(0, 255, 0, 0.75), black 120%)");UI.alert("you are using a theme that is in development if u dont want this propmt then change to another one if you dont care then click ok [the side bars make the page look bad i will eventually fix it (not loliconman if u can find me come bug me about it in the discord server)]",{top:50},function(){UI.settings()});break;case"classic":g.style.setProperty("--MainColor","#06f"),g.style.setProperty("--main","#004e98");break;case"custom":alert("this is currently in the list to be added");case"Random Color":g.style.setProperty("--MainColor",randomColor()),g.style.setProperty("--main",randomColor())}};Setting.addList("theme",{label:"Choose a theme.",list:settingThemeNames,default:"classic",onInit:settingThemeHandler,onChange:settingThemeHandler});var smokingToggle=function(){state.variables.Smoking=settings.Smoking?1:0},smokingCheck=function(){return!0===state.variabels.Smoking};!function(){var u={tryGlobal:!0,defaultStrings:{empty:"The inventory is empty...",listDrop:"Discard",separator:"\n"}};function s(e,t,r,n){$(document).trigger({type:"initialized"===n?":inventory-init":":inventory-update",instance:e,receiving:t,moved:r,context:n})}function c(e){if(e=e?(e=[].slice.call(arguments)).flatten():[],!(this instanceof c))return new c(e);this.inv=e,s(this,null,e=e.length?e:null,"initialized")}Object.assign(c,{is:function(e){return e instanceof c},log:function(e){return c.is(e)?"Inventory.log() -> "+e.toArray().join(" - "):"Inventory.log() -> object is not an inventory..."},removeDuplicates:function(e){if(c.is(e)){var t,e=e.toArray();return t=[],e.forEach(function(e){t.includes(e)||t.push(e)}),t}}}),Object.assign(c.prototype,{transfer:function(e){if(arguments.length<2)return this;if(!c.is(e))return this;for(var t=[].slice.call(arguments),r=[],n=0,i=(t=t.slice(1).flatten()).length;n<i;n++)this.inv.includes(t[n])&&(this.inv.delete(t[n]),r.push(t[n]));return r.length&&(e.inv=e.inv.concat(r),s(this,e,r,"transfer")),this},has:function(){var e=[].slice.call(arguments).flatten();return!(!e||!e.length)&&this.inv.includesAny(e)},hasAll:function(){var e=[].slice.call(arguments).flatten();return!(!e||!e.length)&&this.inv.includesAll(e)},pickUp:function(e){var t,r=[].slice.call(arguments).flatten(),n=this;return r&&r.length&&("unique"!==e&&"unique"!==r[0]||(r=r.splice(1),t=[],r.forEach(function(e){n.inv.includes(e)||t.includes(e)||t.push(e)}),r=t),this.inv=this.inv.concat(r),s(this,null,r,"pickup")),this},drop:function(){var t,r,e=[].slice.call(arguments).flatten(),n=this;return e&&e.length&&(r=[],e.forEach(function(e){n.has(e)&&(r.push(e),t=n.inv.indexOf(e),n.inv.deleteAt(t))}),s(this,null,r,"drop")),this},sort:function(){return this.inv=this.inv.sort(),s(this,null,null,"sort"),this},show:function(e){return e&&"string"==typeof e||(e=u.defaultStrings.separator),this.inv.length?this.inv.join(e):u.defaultStrings.empty},empty:function(){var e=clone(this.inv);return this.inv=[],s(this,null,e,"drop"),this},toArray:function(){return this.inv},count:function(t){if(t&&"string"==typeof t){var r=0;return this.toArray().forEach(function(e){e===t&&r++}),r}return this.toArray().length},isEmpty:function(){return 0===this.toArray().length},linkedList:function(a,o){a&&c.is(a)||(a=!1);var e=this.toArray(),l=this,h=$(document.createElement("span"));return e&&e.length?e.forEach(function(e,t,r){var n=$(document.createElement("span")),i=$(document.createElement("a")),s=(o||u.defaultStrings.drop,function(e,t){var r=Math.random().toString(36).substring(7);return arguments.length<2&&(e=Math.random().toString(36).substring(7),t=random(99)),"simple-inv-"+t+"-"+Date.now()+"-"+e.replace(/[^A-Za-z0-9]/g,"")+"-"+r}(e,t));i.ariaClick(function(){a?l.transfer(a,e):l.drop(e),$("#"+s).empty()}),n.attr("id",s).addClass("simple-inv link-listing").wiki(e+" ").append(i),t<r.length-1&&n.wiki("<br />"),h.append(n)}):h.wiki(u.defaultStrings.empty),h},constructor:c,toJSON:function(){return JSON.reviveWrapper("new setup.Inventory("+JSON.stringify(this.inv)+")")},clone:function(){return new c(this.inv)}}),setup.Inventory=c,setup.simpleInv={inventory:c},u.tryGlobal&&(window.Inventory=window.Inventory||c),Macro.add("newinventory",{handler:function(){if(this.args.length<1)return this.error("incorrect number of arguments");var e=this.args[0].trim();if("$"!==e[0]&&"_"!==e[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');Wikifier.setValue(e,new c(this.args.slice(1).flatten()))}}),Macro.add("pickup",{handler:function(){if(this.args.length<2)return this.error("incorrect number of arguments");var e=this.args[0].trim();if("$"!==e[0]&&"_"!==e[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var t=Wikifier.getValue(e);if(!c.is(t))return this.error("variable "+e+" is not an inventory!");t.pickUp(this.args.slice(1).flatten())}}),Macro.add("drop",{handler:function(){if(this.args.length<2)return this.error("incorrect number of arguments");var e=this.args[0].trim();if("$"!==e[0]&&"_"!==e[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var t=Wikifier.getValue(e);if(!c.is(t))return this.error("variable "+e+" is not an inventory!");t.drop(this.args.slice(1).flatten())}}),Macro.add("transfer",{handler:function(){if(this.args.length<3)return this.error("incorrect number of arguments");var e=this.args[0].trim();if("$"!==e[0]&&"_"!==e[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var t=Wikifier.getValue(e);if(!c.is(t))return this.error("variable "+e+" is not an inventory!");var r=this.args[1].trim();if("$"!==r[0]&&"_"!==r[0])return this.error('variable name "'+this.args[1]+'" is missing its sigil ($ or _)');e=Wikifier.getValue(r);if(!c.is(e))return this.error("variable "+r+" is not an inventory!");t.transfer(e,this.args.slice(2).flatten())}}),Macro.add("dropall",{handler:function(){if(1!==this.args.length)return this.error("incorrect number of arguments");var e=this.args[0].trim();if("$"!==e[0]&&"_"!==e[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var t=Wikifier.getValue(e);if(!c.is(t))return this.error("variable "+e+" is not an inventory!");t.empty()}}),Macro.add("clear","dropall",!1),Macro.add("sort",{handler:function(){if(1!==this.args.length)return this.error("incorrect number of arguments");var e=this.args[0].trim();if("$"!==e[0]&&"_"!==e[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var t=Wikifier.getValue(e);if(!c.is(t))return this.error("variable "+e+" is not an inventory!");t.sort()}}),Macro.add("inventory",{handler:function(){if(this.args.length<1||2<this.args.length)return this.error("incorrect number of arguments");var e=this.args[0].trim();if("$"!==e[0]&&"_"!==e[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var t=Wikifier.getValue(e);if(!c.is(t))return this.error("variable "+e+" is not an inventory!");var r=$(document.createElement("span")),e=this.args[1]||!1;r.wiki(t.show(e)).addClass("macro-"+this.name).appendTo(this.output)}}),Macro.add("linkedinventory",{handler:function(){if(this.args.length<2||3<this.args.length)return this.error("incorrect number of arguments");var e=!1,t="",r=this.args[1].trim(),n="string"==typeof this.args[0]&&this.args[0];if(!n)return this.error("first argument should be the link text");if("$"!==r[0]&&"_"!==r[0])return this.error('variable name "'+this.args[1]+'" is missing its sigil ($ or _)');var i=Util.slugify(r),i=this.name+"-"+i,s=Wikifier.getValue(r);if(!c.is(s))return this.error("variable "+r+" is not an inventory!");if(2<this.args.length){if("$"!==(t=this.args[2].trim())[0]&&"_"!==t[0])return this.error('variable name "'+this.args[2]+'" is missing its sigil ($ or _)');if(e=Wikifier.getValue(t),!c.is(e))return this.error("variable "+t+" is not an inventory!")}s.linkedList(e,n).attr({id:i,"data-rec":t,"data-self":r,"data-action":n}).addClass("macro-"+this.name).appendTo(this.output)}})}();